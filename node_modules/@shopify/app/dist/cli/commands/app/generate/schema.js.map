{"version":3,"file":"schema.js","sourceRoot":"","sources":["../../../../../src/cli/commands/app/generate/schema.ts"],"names":[],"mappings":"AAAA,OAAO,EAAC,qBAAqB,EAAC,MAAM,sCAAsC,CAAA;AAC1E,OAAO,EAAC,QAAQ,EAAC,MAAM,mBAAmB,CAAA;AAE1C,OAAO,EAAC,IAAI,IAAI,OAAO,EAAC,MAAM,+BAA+B,CAAA;AAC7D,OAAO,EAAC,4BAA4B,EAAC,MAAM,8CAA8C,CAAA;AACzF,OAAO,EAAC,KAAK,EAAC,MAAM,aAAa,CAAA;AACjC,OAAO,EAAC,WAAW,EAAC,MAAM,2BAA2B,CAAA;AACrD,OAAO,OAAO,MAAM,oCAAoC,CAAA;AACxD,OAAO,EAAC,MAAM,EAAC,MAAM,kBAAkB,CAAA;AACvC,OAAO,EAAC,WAAW,EAAE,GAAG,EAAC,MAAM,4BAA4B,CAAA;AAC3D,OAAO,EAAC,UAAU,EAAC,MAAM,6BAA6B,CAAA;AAEtD,MAAM,CAAC,OAAO,OAAO,cAAe,SAAQ,OAAO;IAgB1C,KAAK,CAAC,GAAG;QACd,MAAM,EAAC,KAAK,EAAE,IAAI,EAAC,GAAG,MAAM,IAAI,CAAC,KAAK,CAAC,cAAc,CAAC,CAAA;QACtD,MAAM,MAAM,GAAG,KAAK,CAAC,SAAS,CAAC,CAAA;QAC/B,MAAM,SAAS,GAAG,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC,WAAW,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,GAAG,EAAE,CAAA;QAC9D,MAAM,cAAc,GAAG,MAAM,4BAA4B,CAAC,IAAI,CAAC,MAAM,CAAC,CAAA;QACtE,MAAM,GAAG,GAAiB,MAAM,OAAO,CAAC,EAAC,SAAS,EAAE,cAAc,EAAC,CAAC,CAAA;QACpE,MAAM,SAAS,GAAG,GAAG,CAAC,UAAU,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,SAAS,EAAE,EAAE,CAAC,SAAS,CAAC,eAAe,KAAK,IAAI,CAAC,QAAQ,CAAC,CAAA;QAE1G,IAAI,CAAC,SAAS,EAAE;YACd,MAAM,SAAS,GAAG,GAAG,CAAC,UAAU,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,SAAS,EAAE,EAAE,CAAC,SAAS,CAAC,eAAe,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAA;YAElG,MAAM,IAAI,UAAU,CAClB,MAAM,CAAC,OAAO,CAAA,qBAAqB,IAAI,CAAC,QAAQ,qBAAqB,EACrE,MAAM,CAAC,OAAO,CAAA,uCAAuC,SAAS,EAAE,CACjE,CAAA;SACF;QAED,MAAM,CAAC,IAAI,CAAC,MAAM,qBAAqB,CAAC,EAAC,GAAG,EAAE,SAAS,EAAE,MAAM,EAAC,CAAC,CAAC,CAAA;IACpE,CAAC;;AAjCM,0BAAW,GAAG,4CAA4C,CAAA;AAE1D,oBAAK,GAAG;IACb,GAAG,WAAW;IACd,GAAG,QAAQ;IACX,SAAS,EAAE,KAAK,CAAC,MAAM,CAAC;QACtB,IAAI,EAAE,SAAS;QACf,WAAW,EAAE,uCAAuC;QACpD,QAAQ,EAAE,KAAK;QACf,GAAG,EAAE,0BAA0B;KAChC,CAAC;CACH,CAAA;AAEM,mBAAI,GAAG,CAAC,EAAC,IAAI,EAAE,UAAU,EAAE,QAAQ,EAAE,IAAI,EAAE,WAAW,EAAE,mDAAmD,EAAC,CAAC,CAAA","sourcesContent":["import {generateSchemaService} from '../../../services/generate-schema.js'\nimport {appFlags} from '../../../flags.js'\nimport {AppInterface} from '../../../models/app/app.js'\nimport {load as loadApp} from '../../../models/app/loader.js'\nimport {loadExtensionsSpecifications} from '../../../models/extensions/specifications.js'\nimport {Flags} from '@oclif/core'\nimport {globalFlags} from '@shopify/cli-kit/node/cli'\nimport Command from '@shopify/cli-kit/node/base-command'\nimport {output} from '@shopify/cli-kit'\nimport {resolvePath, cwd} from '@shopify/cli-kit/node/path'\nimport {AbortError} from '@shopify/cli-kit/node/error'\n\nexport default class GenerateSchema extends Command {\n  static description = 'Generates a GraphQL schema for a function.'\n\n  static flags = {\n    ...globalFlags,\n    ...appFlags,\n    'api-key': Flags.string({\n      name: 'API key',\n      description: 'The API key to fetch the schema with.',\n      required: false,\n      env: 'SHOPIFY_FLAG_APP_API_KEY',\n    }),\n  }\n\n  static args = [{name: 'function', required: true, description: 'The name of the function to fetch the schema for.'}]\n\n  public async run(): Promise<void> {\n    const {flags, args} = await this.parse(GenerateSchema)\n    const apiKey = flags['api-key']\n    const directory = flags.path ? resolvePath(flags.path) : cwd()\n    const specifications = await loadExtensionsSpecifications(this.config)\n    const app: AppInterface = await loadApp({directory, specifications})\n    const extension = app.extensions.function.find((extension) => extension.localIdentifier === args.function)\n\n    if (!extension) {\n      const functions = app.extensions.function.map((extension) => extension.localIdentifier).join(', ')\n\n      throw new AbortError(\n        output.content`No function named ${args.function} found in this app.`,\n        output.content`Use one of the available functions: ${functions}`,\n      )\n    }\n\n    output.info(await generateSchemaService({app, extension, apiKey}))\n  }\n}\n"]}